import { HttpClientModule } from "@angular/common/http";
import { RouterTestingModule } from "@angular/router/testing";
import { IonicModule } from "@ionic/angular";
import { setCompodocJson } from "@storybook/addon-docs/angular";
import {
  INITIAL_VIEWPORTS,
  MINIMAL_VIEWPORTS,
} from "@storybook/addon-viewport";
import { componentWrapperDecorator, moduleMetadata } from "@storybook/angular";
import { NgxPrinterModule } from "ngx-printer";
import { IONIC_VIEWPORTS } from "src/stories/storybook.helpers";
// Generated by the docs:json / storybook npm run commands:
import docJson from "../documentation/documentation.json";
import { TranslocoRootModule } from "../src/app/transloco/transloco-root.module";

setCompodocJson(docJson);

export const parameters = {
  actions: { argTypesRegex: "^on[A-Z].*" },
  controls: {
    matchers: {
      color: /(background|color)$/i,
      date: /Date$/,
    },
  },

  docs: {
    // Docs: https://storybook.js.org/docs/angular/writing-docs/docs-page#inline-stories-vs-iframe-stories
    inlineStories: true,
  },

  // Add Ionic's theme background to the list of available backgrounds, and set it as the default.
  // (This works better than the default "light", for this dark-background app.)
  //
  // Docs: https://storybook.js.org/docs/angular/essentials/backgrounds#configuration
  backgrounds: {
    default: "Ionic theme",
    values: [
      { name: "Ionic theme", value: "var(--ion-background-color)" },
      { name: "light", value: "#F8F8F8" },
      { name: "dark", value: "#333333" },
    ],
  },

  // Docs: https://storybook.js.org/docs/angular/essentials/viewport#configuration
  viewport: {
    defaultViewport: "ionic-sm",
    viewports: {
      ...IONIC_VIEWPORTS,
      ...MINIMAL_VIEWPORTS,
      ...INITIAL_VIEWPORTS,
    },
  },
};

// Provide context for Ionic components
export const decorators = [
  // See AppModule:
  moduleMetadata({
    imports: [
      IonicModule.forRoot(),
      RouterTestingModule,
      HttpClientModule,
      TranslocoRootModule,
      NgxPrinterModule.forRoot({ printOpenWindow: false }),
    ],
  }),
  // See AppComponent's template:
  componentWrapperDecorator(
    (story) => `
      <ion-app>
        <ion-router-outlet>
          ${story}
        </ion-router-outlet>
      </ion-app>
    `
  ),
];
